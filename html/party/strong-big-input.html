<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge">-->
    <!--<meta name="description" content="">-->
    <!--<meta name="keywords" content="">-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>三重一大</title>

    <!--&lt;!&ndash; Set render engine for 360 browser &ndash;&gt;-->
    <!--<meta name="renderer" content="webkit">-->


    <link rel="stylesheet" href="../../assets/css/amazeui.css">
    <link rel="stylesheet" href="../../assets/css/font-awesome.css">
    <link rel="stylesheet" href="../../assets/css/LCommon.css">
    <link rel="stylesheet" href="../../assets/css/sl.css">
    <link rel="stylesheet" href="../../assets/css/plugin/mvalidate/validate.css">
    <script src="../../assets/js/jquery.js"></script>
    <script src="../../assets/js/amazeui.js"></script>
    <!--<script src="../../assets/js/plugin/validate/jquery-mvalidate.js" ></script>&lt;!&ndash;a要用到b中的方法，b必须先加载&ndash;&gt;-->
    <script src="../../assets/js/myFirst.js"></script>
    <!--<script src="../../assets/js/export.js"></script>-->
    <style>
        #vld-tooltip {
            position: absolute;
            z-index: 1000;
            padding: 5px 10px;
            background: #F37B1D;
            min-width: 150px;
            color: #fff;
            transition: all 0.15s;
            box-shadow: 0 0 5px rgba(0,0,0,.15);
            display: none;
        }

        #vld-tooltip:before {
            position: absolute;
            top: -8px;
            left: 50%;
            width: 0;
            height: 0;
            margin-left: -8px;
            content: "";
            border-width: 0 8px 8px;
            border-color: transparent transparent #F37B1D;
            border-style: none inset solid;
        }
    </style>
    <style>

        /*fieldset{*/
            /*padding:0*/
        /*}*/
        input{
            width:90%;
            background-color: #F4F4F4;
            border: 0px;
        }
        button{
            border: 0px;
        }
    </style>
</head>
<body class="">
<div style="margin-top: 3rem;" id="main-content">
    <form id="strongBig" class=""  action="" method="post">
        <fieldset>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6  am-form-group" style="margin-top: 1.5rem;">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <i class="fa fa-asterisk text-icon-color sl-margin-right-02rem " ></i>
                    登记名称
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <input type="text" name="registerName"  placeholder="请输入登记事宜名称" value="" required maxlength="5" data-hint-message="请输入登记事宜名称">
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6  am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <i class="fa fa-asterisk text-icon-color sl-margin-right-02rem" ></i>
                    会议类型
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-space-between sl-padding-0rem-05rem">
                    <input type="text" name="meetingType"  placeholder="请选择会议类型" value="" class="dict-data" readonly required>
                    <i class="fa fa-angle-right sl-icon-color-CACACA"></i>
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6  am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <i class="fa fa-asterisk text-icon-color sl-margin-right-02rem" ></i>
                    是否中心审核
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-space-between sl-padding-0rem-05rem">
                    <input type="text" name="isCenterAudit"  placeholder="请选择是否中心审核" value="" class="dict-data" readonly  required>
                    <i class="fa fa-angle-right sl-icon-color-CACACA"></i>
                </div>
                <!--<div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-flex-start sl-padding-0rem-05rem">-->
                    <!--<label class="sl-flex-row-center-center">-->
                        <!--<input type="radio" checked="checked" name="isCheck" value="1" >-->
                        <!--<span class="sl-margin-0px-5px">是</span>-->
                    <!--</label>-->
                    <!--<label class="sl-flex-row-center-center">-->
                        <!--<input type="radio"  name="isCheck" value="2" >-->
                        <!--<span class="sl-margin-0px-5px">否</span>-->
                    <!--</label>-->
                <!--</div>-->
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6 am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <i class="fa fa-asterisk text-icon-color sl-margin-right-02rem " ></i>
                    备案
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <!--data
                            1:必须已    data-   开头
                            2：如果在 data- 后面有 中划线的话，已中划线分割，将各个字符串拼接，中划线后面的字符串第1个单词大小
                            如果是中划线，$.data()得到的是

                            -->
                    <input type="number" name="putOnRecord"  placeholder="请输入备案" value="" data-amui-validator="aaa" data-amui.validator="bbb" data-amui.change = "DDDDD" >
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6 am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <i class="fa fa-asterisk text-icon-color sl-margin-right-02rem " ></i>
                    结论
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <input type="text" name="conclusion"  placeholder="请输入结论" value="" required maxlength="6">
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6 am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <i class="fa fa-asterisk text-icon-color sl-margin-right-02rem" ></i>
                    通知对象
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-space-between sl-padding-0rem-05rem">
                    <input type="text" name="informObject"  placeholder="请选择通知对象" value="" class="dict-data" readonly required="required">
                    <i class="fa fa-angle-right sl-icon-color-CACACA"></i>
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6 am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <i class="fa fa-asterisk text-icon-color sl-margin-right-02rem" ></i>
                    相应会议记录
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-space-between sl-padding-0rem-05rem">
                    <!--<div class="meeting-record" >请选择相应会议记录</div>-->
                    <!--<i class="fa fa-angle-right sl-icon-color-CACACA"></i>-->
                    <input type="text" name="meetingRecord" id="meetingRecord" class="dict-data" placeholder="请选择相应会议记录" value="" required readonly>
                    <input type="hidden" name="meetingRecordId" id="meetingRecordId" value="">
                    <i class="fa fa-angle-right sl-icon-color-CACACA"></i>
                </div>
            </div>
            <div class="am-g sl-margin-top-10px sl-flex-row-center-center am-form-group">
                <div class="am-u-sm-6 am-u-md-6 am-u-lg-6">
                    <div class=" am-form-file">
                        <button type="button" class="am-btn am-btn-danger am-btn-sm">
                            <!--<i class="am-icon-cloud-upload"></i> 上传附件</button>-->
                            上传附件</button>
                        <input id="doc-form-file" type="file" multiple onchange="html5Upload()" name="relatedAccessory" placeholder="请上传附件" value="" readonly required>
                        <input type="hidden" name="relatedAccessoryName">
                        <input type="hidden" name="relatedAccessoryId">
                    </div>
                </div>
                <div class="am-u-sm-6 am-u-md-6 am-u-lg-6 sl-flex-row-center-center sl-padding-0px">
                    <span class="" id="hintImage" style="display: none">点击文件删除文件、<br/>最多上传3个文件</span>
                </div>
            </div>
            <ul class="am-avg-sm-4 am-avg-md-4 am-avg-lg-4" id="result">

            </ul>
            <div class="sl-flex-row-center-flex-end" style="position: fixed;top: 0.84rem;right: 0.84rem;z-index: 10002">
                <button type="submit"  id="submitForm" class="sl-margin-right-1rem" style="color:white;background-color: #F14551;">发布</button>
                <button type="submit" class="sl-margin-right-1rem" style="color:white;background-color: #F14551;">存为草稿</button>
            </div>
        </fieldset>
    </form>
</div>
<script>
    $(function () {
//       $("#strongBig").validator({
//           H5Validation: false,
//           H5inputType: ['email', 'url', 'number'],
//           patterns: {},//验证规则
//           patternClassPrefix: 'js-pattern-',//规则class钩子前缀
//           activeClass: 'am-active',
//           inValidClass: 'am-field-error',//验证不通过添加到域上的class1
//           validClass: 'am-field-valid',//验证通过时添加到域上的class
//           validateOnSubmit: true,//表单提交时验证
//           allFields: ':input:not(:button, :disabled, .am-novalidate)',//表单提交时验证的域
//           ignore: ':not([data-am-selected], .am-validate)',//表单提交时验证忽略的域
//           customEvents: 'validate()',//调用validate()方法的自定义事件
//
//
//           onValid: function (validity) {//域对象通过验证是回调
//
//
//           },
//           onInValid: function (validity) {//域对象验证出错时回调
////                var $field = $(validity.field);
////                var $group = $field.closest('.am-form-group');
////                var $alert = $('body').find('am-alert');
//
//
//               var $form = $('#strongBig');
//               var $tooltip = $('<div id="vld-tooltip">提示信息！</div>');
//               console.log("onInValid:::::");
//               $tooltip.appendTo(document.body);
//
//
//
//
//               var validator = $form.data('amui.validator');
//               $form.on('focusin focusout', 'am-form-error input', function (e) {
//                   if(e.type === 'focusin'){
//                       var $this = $(this);//this代表input对象
//                       var offset = $this.offset();
//                       var msg = $this.data('foolishMsg') || validator.getValidationMessage($this.data('validity'));
//                       $tooltip.text(msg).show().css({
//                           left: offset.left + 10,
//                            top: offset.top + 10
//                       })
//                   }else {
//                       $tooltip.hide();
//                   }
//               })
//
//
//           },
//           markValid: function (validity) {//域对象验证通过时添加的操作，通过该接口可以定义各种验证提示，
//               var options = this.options;//this指的的Validator对象
//               alert("mv:"+options);
//               var $field = $(validity.field);
//               var $parent = $field.closest('.am-form-group');
//               $field.addClass(options.validClass).removeClass(options.inValidClass);
//               $parent.addClass('am-form-success').removeClass('am-form-error');
//               options.onValid.call(this, validity);
//           },
//           markInValid: function (validity) {//域验证失败是添加的操作，通过该接口可以定义各种验证提示
//             console.log("1111");
//                var options = this.options;//this指的是Validator对象
//                var $field = $(validity.field);
//                var $parent = $field.closest('.am-form-group');
//                $field.addClass(options.inValidClass + ' ' + options.activeClass).removeClass(options.validClass);
//                $parent.addClass('am-form-error').removeClass('am-form-success');
//                options.onInValid.call(this,validity);
//
//           },
//           validity: function (validity) {//自定义验证接口
//
//           },
//           submit: function () {
//               var formValidity = this.isFormValid();
//               $.when(formValidity).then(function () {
//                   //form的验证状态是验证成功状态，所执行的逻辑
//               },function () {
//                   //form的验证状态是不通过状态，所执行的逻辑
//               })
//           }
//       })
    });
//$(function() {
//    var $form = $('#strongBig');
//    var $tooltip = $('<div id="vld-tooltip" style="position:fixed;z-index: 10010;">提示信息！</div>');
//    $tooltip.appendTo(document.body);
//
//    $form.validator();
//
//    var validator = $form.data('amui.validator');
//
//    $form.on('focusin focusout', 'input', function(e,validity) {
//        if (e.type === 'focusin') {
//            var $this = $(this);
//            var offset = $this.offset();
//            var msg = $this.data('foolishMsg') || validator.getValidationMessage(validity);
//
//            $tooltip.text(msg).show().css({
//                left: offset.left + 10,
//                top: offset.top + $(this).outerHeight() + 10
//            });
//        } else {
//            $tooltip.hide();
//        }
//    });
//
//});
    $(function() {
//        $('#strongBig').data('key','1');
            console.log($('[name="putOnRecord"]').data('amui-validator'));
        console.log($('[name="putOnRecord"]').data('amui.validator'));
        $('[name="putOnRecord"]').data('amui.validator','cccccc');
//        var v = AMUI.validator
//        $('#strongBig').fn.toArray();
//        $('#strongBig').toArray()
        $('#strongBig').validator({
            onValid: function(validity) {
//                $(validity.field).closest('.am-form-group').find('.am-alert').hide();
                $('body').find('.am-alert').hide();
            },


            onInValid: function(validity) {
//                console.log(validity);
                var $field = $(validity.field);
//                console.log($field);
                var $group = $field.closest('.am-form-group');
//                var offset = $group.offset();
                var $alert = $('<div class="my-alert" style="display: block;background-color: black;position:fixed;z-index: 10011;color: white;padding: 0.5rem;-webkit-border-radius: .5rem;-moz-border-radius: .5rem;border-radius: .5rem;"></div>');
                var len = $('div.my-alert').length;
                if(len){
                    $('div.my-alert').css('display','block')
                }else{
                    $('body').append($alert);

                }


                // 使用自定义的提示信息 或 插件内置的提示信息
//                console.log("field:"+$field.attr('name'));
//                var msg = $field.attr('placeholder') || this.getValidationMessage(validity);
                var msg =this.getValidationMessage(validity);

//                if (!$alert.length) {
//                    $alert = $('<div class="am-alert am-alert-danger"  id="vld-tooltip" style="position:fixed;z-index: 10010;"></div>').hide().
//                    appendTo($group);
//                }

//                if($alert.length) {
//                    $alert.index(1).remove();
//                }
//                console.log("msg:"+msg);
                    $alert.html(msg).css({
                        left: window.innerWidth/2-$alert.outerWidth()/2,
                        top: window.innerHeight/2-$alert.outerHeight()/2,
                    });
                    setTimeout(function () {
                        $('div.my-alert').css('display','none');
                    },2000)
            },
        });
    });


    //将文件以DataURL形式读入页面
    function html5Upload() {
        var file;
        var fileReader;
        var fileTag = document.getElementById("doc-form-file").files;//每次点击按钮上传的图片个数
        var len = fileTag.length;
//        //判断是否是图片
//        for (var i = 0; i < len; i++) {
//            var simpleFile = fileTag[i];
//            if(!/image\/\w+/.test(simpleFile.type)){
//                alert("请确保文件类型为图像类型");
//                return false;
//            }
//        }
//        if(!/image\/\w+/.test(simpleFile.type)){
//            alert("请确保文件类型为图像类型");
//            return false;
//        }
        //一次性上传图片
        if(len > 3){
            alert("最多上传3个文件");
            return ;
        }
        //分多次上传图片
        var num = $("#result").children().length;
        if(num + len > 3){
            alert("最多上传3个文件");
            return;
        }


        //显示和隐藏提示信息
        if(len+num > 0){
            $("#hintImage").css('display','block');
        }else{
            $("#hintImage").css('display','none');
        }
        for (var i = 0; i < fileTag.length; i++) {
            file = fileTag[i];
            var name = file.name;
            var div = '<li style="width: 100%;" onclick="removeSelf(this)"><div  class="sl-flex-row-center-flex-start" style="border:3px solid #E1E1E1;background-color: #F6F6F8;padding: 0.3rem;margin: .3rem .6rem;"><i class="fa fa-ils fa-lg text-success" ></i><div style="color: black;">'+name+'</div></div></li>';
            $("#result").append(div);
            var l = $("#result").find('i').length;
//            alert("LLL:"+l);
            var n = '';
            $("#result").find('i').next().each(function (i,v) {
//                alert("III:"+i);
                if(l == i +1){
                    n += $(this).html();
                }else{
                    n += $(this).html()+",";
                }
            });
//            sessionStorage.setItem('relatedAccessory',n);


        }
    }
    //点击图片，删除图片
    function removeSelf(p) {
        var name = '';
        var len = $(p).siblings('li').find('i').length;

        $(p).siblings('li').find('i').next().each(function (i,v) {
            if(len == i +1){
                name += $(this).html();
            }else{
                name += $(this).html()+",";
            }

        });
//        console.log("n:"+name+"l"+ $(p).siblings('li').length);
        $(p).remove();



//         sessionStorage.setItem('relatedAccessory',name);
        $("input:file").val(name);
//        console.log("fName："+fName);
//        if(fName == null){
//            sessionStorage.setItem('relatedAccessory',name);
//        }else{
//            sessionStorage.setItem('relatedAccessory',fName+','+name);
//        }
        var num = $("#result").children();
        if(num.length > 0){
            $("#hintImage").css('display','block');
        }else{
            $("#hintImage").css('display','none');
        }
    }

</script>

</body>
</html>