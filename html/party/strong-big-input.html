<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge">-->
    <!--<meta name="description" content="">-->
    <!--<meta name="keywords" content="">-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>三重一大</title>

    <!--&lt;!&ndash; Set render engine for 360 browser &ndash;&gt;-->
    <!--<meta name="renderer" content="webkit">-->


    <link rel="stylesheet" href="../../assets/css/amazeui.css">
    <!--<link rel="stylesheet" href="../../assets/css/font-awesome.css">-->
    <link rel="stylesheet" href="../../assets/css/LCommon.css">
    <link rel="stylesheet" href="../../assets/css/sl.css">
    <script src="../../assets/js/jquery.js"></script>
    <script src="../../assets/js/amazeui.js"></script>
    <script src="../../assets/js/myFirst.js"></script>
    <style>
        #vld-tooltip {
            position: absolute;
            z-index: 1000;
            padding: 5px 10px;
            background: #F37B1D;
            min-width: 150px;
            color: #fff;
            transition: all 0.15s;
            box-shadow: 0 0 5px rgba(0,0,0,.15);
            display: none;
        }

        #vld-tooltip:before {
            position: absolute;
            top: -8px;
            left: 50%;
            width: 0;
            height: 0;
            margin-left: -8px;
            content: "";
            border-width: 0 8px 8px;
            border-color: transparent transparent #F37B1D;
            border-style: none inset solid;
        }
    </style>
    <style>
        input{
            width:90%;
            background-color: #F4F4F4;
            border: 0px;
        }
        button{
            border: 0px;
        }
    </style>
</head>
<body class="">
<div class="top-div">
       <div class="sl-flex-row-center-space-between sl-background-color-red top-info sl-font-color-white" >
                <a href="party.html" onclick="destroyValidator()"><i class="am-icon-angle-left am-icon-sm" style="margin-left: 0.5rem;color: white;"></i></a>
        </div>
</div>
<div style="margin-top: 3rem;" id="main-content">
    <form id="strongBig" class=""  action="" method="post">
        <fieldset>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6  am-form-group" style="margin-top: 1.5rem;">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <!--<i class="fa fa-asterisk text-icon-color sl-margin-right-02rem " ></i>-->
                    <i class="am-icon-asterisk text-icon-color sl-margin-right-02rem"></i>
                    登记名称
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <input type="text" name="registerName"  placeholder="请输入登记事宜名称" value="" required >
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6  am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <!--<i class="fa fa-asterisk text-icon-color sl-margin-right-02rem" ></i>-->
                    <i class="am-icon-asterisk text-icon-color sl-margin-right-02rem"></i>
                    会议类型
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-space-between sl-padding-0rem-05rem">
                    <input type="text" name="meetingType"  placeholder="请选择会议类型" value="" class="dict-data" readonly required>
                    <i class="am-icon-angle-right sl-icon-color-CACACA"></i>
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6  am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <!--<i class="fa fa-asterisk text-icon-color sl-margin-right-02rem" ></i>-->
                    <i class="am-icon-asterisk text-icon-color sl-margin-right-02rem"></i>
                    是否中心审核
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-space-between sl-padding-0rem-05rem">
                    <input type="text" name="isCenterAudit"  placeholder="请选择是否中心审核" value="" class="dict-data" readonly  required>
                    <i class="am-icon-angle-right sl-icon-color-CACACA"></i>
                </div>
                <!--<div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-flex-start sl-padding-0rem-05rem">-->
                    <!--<label class="sl-flex-row-center-center">-->
                        <!--<input type="radio" checked="checked" name="isCheck" value="1" >-->
                        <!--<span class="sl-margin-0px-5px">是</span>-->
                    <!--</label>-->
                    <!--<label class="sl-flex-row-center-center">-->
                        <!--<input type="radio"  name="isCheck" value="2" >-->
                        <!--<span class="sl-margin-0px-5px">否</span>-->
                    <!--</label>-->
                <!--</div>-->
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6 am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <!--<i class="fa fa-asterisk text-icon-color sl-margin-right-02rem " ></i>-->
                    <i class="am-icon-asterisk text-icon-color sl-margin-right-02rem"></i>
                    备案
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <input type="text" name="putOnRecord"  placeholder="请输入备案" value="" required >
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6 am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <!--<i class="fa fa-asterisk text-icon-color sl-margin-right-02rem " ></i>-->
                    <i class="am-icon-asterisk text-icon-color sl-margin-right-02rem"></i>
                    结论
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <input type="text" name="conclusion"  placeholder="请输入结论" value="" required maxlength="6">
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6 am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <!--<i class="fa fa-asterisk text-icon-color sl-margin-right-02rem" ></i>-->
                    <i class="am-icon-asterisk text-icon-color sl-margin-right-02rem"></i>
                    通知对象
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-space-between sl-padding-0rem-05rem">
                    <input type="text" name="informObject"  placeholder="请选择通知对象" value="" class="dict-data" readonly required="required">
                    <i class="am-icon-angle-right sl-icon-color-CACACA"></i>
                </div>
            </div>
            <div class="am-g sl-border-bottom-1px-solid-E6E6E6 am-form-group">
                <div class="am-u-sm-4 am-u-md-4 am-u-lg-4 sl-flex-row-center-flex-start sl-padding-0rem-05rem">
                    <!--<i class="fa fa-asterisk text-icon-color sl-margin-right-02rem" ></i>-->
                    <i class="am-icon-asterisk text-icon-color sl-margin-right-02rem"></i>
                    相应会议记录
                </div>
                <div class="am-u-sm-8 am-u-md-8 am-u-lg-8 sl-flex-row-center-space-between sl-padding-0rem-05rem">
                    <!--<div class="meeting-record" >请选择相应会议记录</div>-->
                    <!--<i class="fa fa-angle-right sl-icon-color-CACACA"></i>-->
                    <input type="text" name="meetingRecord" id="meetingRecord" class="dict-data" placeholder="请选择相应会议记录" value="" required readonly>
                    <input type="hidden" name="meetingRecordId" id="meetingRecordId" value="">
                    <i class="am-icon-angle-right sl-icon-color-CACACA"></i>
                </div>
            </div>
            <div class="am-g sl-margin-top-10px sl-flex-row-center-center am-form-group">
                <div class="am-u-sm-6 am-u-md-6 am-u-lg-6">
                    <div class=" am-form-file">
                        <button type="button" class="am-btn am-btn-danger am-btn-sm">
                            <!--<i class="am-icon-cloud-upload"></i> 上传附件</button>-->
                            上传附件</button>
                        <input id="doc-form-file" type="file" multiple onchange="html5Upload()" name="relatedAccessory" placeholder="请上传附件" value="" readonly required>
                        <input type="hidden" name="relatedAccessoryName">
                        <input type="hidden" name="relatedAccessoryId">
                    </div>
                </div>
                <div class="am-u-sm-6 am-u-md-6 am-u-lg-6 sl-flex-row-center-center sl-padding-0px">
                    <span class="" id="hintImage" style="display: none">点击文件删除文件、<br/>最多上传3个文件</span>
                </div>
            </div>
            <ul class="am-avg-sm-4 am-avg-md-4 am-avg-lg-4" id="result" style="margin-bottom: 1.5rem;">

            </ul>
            <div class="sl-flex-row-center-flex-end" style="position: fixed;top: 0.84rem;right: 0.84rem;z-index: 10002">
                <button type="submit"  id="submitForm" class="sl-margin-right-1rem" style="color:white;background-color: #F14551;">发布</button>
                <button type="submit" class="sl-margin-right-1rem" style="color:white;background-color: #F14551;">存为草稿</button>
            </div>
        </fieldset>
    </form>
</div>
<div data-am-widget="navbar" class="am-navbar am-cf am-navbar-default "
     id="">
    <ul class="am-navbar-nav am-cf am-avg-sm-2">
        <li >
            <a href="#" class="" style="color: red">
                <span class="am-icon-plus"></span>
                <span class="am-navbar-label">新建三重一大</span>
            </a>
        </li>
        <li >
            <a href="strong-big-checkList.html" class="sl-icon-color-red">
                <span class="am-icon-check"></span>
                <span class="am-navbar-label">审批三重一大</span>
            </a>
        </li>
    </ul>
</div>
<script>
    //全局变量
    var oneOrMany=['0','0','1','1'];
    var rem = new Rem();
    //获取dict数据
    $(function () {
        var arr = ['meetingType','isCenterAudit','informObject','meetingRecord'];
        for(var i =0;i < arr.length; i++){
            $('input[name="'+arr[i]+'"]').val(sessionStorage.getItem(arr[i]));
        }
    });
    //设置dict条件
    $("div.am-g").click(function () {
        var eleInput = $(this).find('input.dict-data').parent().get(0);//DOM元素对象
        // console.log("len:"+$('input.dict-data').parent().length);
        $('input.dict-data').parent().each(function (i,v) {
            if(eleInput == v){
                sessionStorage.setItem('val',$(this).find('input.dict-data').val());
                sessionStorage.setItem('fieldName',$(this).find('input.dict-data').prop('name'));
                if(parseInt(oneOrMany[i]) === 0){
                    sessionStorage.setItem('type','radio');
                }else{
                    sessionStorage.setItem('type','checkbox');
                }
                location.href='../dict-search.html'
            }
        });
    });

    $(function() {
        $('#strongBig').validator({
//            keyboardEvents: 'focusout',
            onValid: function(validity) {
//                $(validity.field).closest('.am-form-group').find('.am-alert').hide();
                $('body').find('.am-alert').hide();
//                console.log(validity);
//                console.log(this.options.onValid);
            },


            onInValid: function(validity) {
                console.log('13')
                var _this = this;
//                console.log(validity);
                var $field = $(validity.field);
//                console.log($field);
                var $group = $field.closest('.am-form-group');
//                var offset = $group.offset();



                // 使用自定义的提示信息 或 插件内置的提示信息
//                console.log("field:"+$field.attr('name'));
//                var msg = $field.attr('placeholder') || this.getValidationMessage(validity);
//                console.log($field.attr('placeholder'));
                console.log(validity);
                console.log(validity.valueMissing);
                console.log(validity.rangeUnderflow);
//                var msg = '';
//                var ro = $field.attr('readonly');
                var msg;
                if(validity.valueMissing){
                     msg = $field.prop('placeholder')
                }
                rem.alertInfo(msg);
//                else if(validity.typeMismatch){
//                    if($field.attr('type') === 'number'){
//                        msg = $field.data('notNumber');
//                    }
//                }
//                if(validity.rangeUnderflow){
//                    if($field.attr('min')){
//                        msg = $field.data('foolishMsg');
//                    }
//                }
//                var h = false;
//                console.log("ro:"+ro);
//                if(ro !=='undefined' || $field.attr('type') === 'file'){
//                    h =true;
//                }
//                console.log("h:"+h);

//                var $alert = $('<div class="my-alert" style="display: block;background-color: black;position:fixed;z-index: 10011;color: white;padding: 0.5rem;-webkit-border-radius: .5rem;-moz-border-radius: .5rem;border-radius: .5rem;"></div>');
//                var len = $('div.my-alert').length;
//                if(len){
////                    if(h){
//                        $('div.my-alert').html(msg).show().css({
//                            left: screen.width/2-$('div.my-alert').outerWidth()/2,
//                            top: screen.height/2-$('div.my-alert').outerHeight()/2,
//                        });
////                    }else{
////                        $('div.my-alert').html(msg).hide();
////                    }
////                    console.log(msg);
//
//                }else{
//                    $('body').append($alert);
//
//                    $alert.html(msg).show().css({
//                        left: screen.width/2-$('div.my-alert').outerWidth()/2,
//                        top: screen.height/2-$('div.my-alert').outerHeight()/2,
//                    });
//                }
//                console.log("SW:"+screen.width/2+",SH:"+screen.height/2+"AW:"+$('div.my-alert').outerWidth()/2+",AH:"+$('div.my-alert').outerHeight()/2)
//                setTimeout(function () {
//                    $('div.my-alert').hide();
//                },2000);
//                console.log("valid_end")
            },
            markInValid: function(validity) {
                console.log('12')
                var options = this.options;
                var $field = $(validity.field);
                var $parent = $field.closest('.am-form-group');

                $field.addClass(options.inValidClass + ' ' + options.activeClass).
                removeClass(options.validClass);
                $parent.addClass('am-form-error').removeClass('am-form-success');
                options.onInValid.call(this, validity);
            },
            submit: function (e) {
                console.log("6");
                var formValidity = this.isFormValid();
                if(typeof formValidity === 'boolean'){
//                    alert(typeof formValidity);
                    if(formValidity){
//                        alert("true");
                        e.preventDefault();
                        sessionStorage.setItem('bottomNavIndex',0);
                        $("#my-confirm").modal({
                            onConfirm: function () {
                                // alert();
                                $(function () {
                                    var arr = ['meetingType','isCenterAudit','informObject','meetingRecord'];
                                    for(var i =0;i < arr.length; i++){
                                       sessionStorage.removeItem(arr[i]);
                                    }
                                });
                                location.href='strong-big-CheckList.html';
                            },
                            onCancel: function () {
                                return false;
                            }
                        });
//                        location.href='strong-big-readList.html';
//                        alert("end");
                    }else{
                        return false;
//                    e.preventDefault();

                    }
                }else{

                }

//                $.when(formValidity).then(function() {
//                    // 验证成功的逻辑
//                    alert("valid111")
//                    location.href='strong-big-readList.html'
//                }, function() {
//                    alert("inValid")
//                    // 验证失败的逻辑
//                });
            }
        });
    });
    //返回页面之前，销毁validator
    function destroyValidator() {
        $("#strongBig").off('submit.validator.amui');//form对象解除绑定的事件
        $(":input:not(:submit, :button, :disabled, .am-novalidate)").off('focusout, change');//input对象解除绑定的事件
    }


    //将文件以DataURL形式读入页面
    function html5Upload() {
        var file;
        var fileReader;
        var fileTag = document.getElementById("doc-form-file").files;//每次点击按钮上传的图片个数
        var len = fileTag.length;
//        //判断是否是图片
//        for (var i = 0; i < len; i++) {
//            var simpleFile = fileTag[i];
//            if(!/image\/\w+/.test(simpleFile.type)){
//                alert("请确保文件类型为图像类型");
//                return false;
//            }
//        }
//        if(!/image\/\w+/.test(simpleFile.type)){
//            alert("请确保文件类型为图像类型");
//            return false;
//        }
        //一次性上传图片
        if(len > 3){
            alert("最多上传3个文件");
            return ;
        }
        //分多次上传图片
        var num = $("#result").children().length;
        if(num + len > 3){
            alert("最多上传3个文件");
            return;
        }


        //显示和隐藏提示信息
        if(len+num > 0){
            $("#hintImage").css('display','block');
        }else{
            $("#hintImage").css('display','none');
        }
        for (var i = 0; i < fileTag.length; i++) {
            file = fileTag[i];
            var name = file.name;
            var div = '<li style="width: 100%;" onclick="removeSelf(this)"><div  class="sl-flex-row-center-flex-start" style="border:3px solid #E1E1E1;background-color: #F6F6F8;padding: 0.3rem;margin: .3rem .6rem;"><i class="fa fa-ils fa-lg text-success" ></i><div style="color: black;">'+name+'</div></div></li>';
            $("#result").append(div);
            var l = $("#result").find('i').length;
//            alert("LLL:"+l);
            var n = '';
            $("#result").find('i').next().each(function (i,v) {
//                alert("III:"+i);
                if(l == i +1){
                    n += $(this).html();
                }else{
                    n += $(this).html()+",";
                }
            });
//            sessionStorage.setItem('relatedAccessory',n);


        }
    }
    //点击图片，删除图片
    function removeSelf(p) {
        var name = '';
        var len = $(p).siblings('li').find('i').length;

        $(p).siblings('li').find('i').next().each(function (i,v) {
            if(len == i +1){
                name += $(this).html();
            }else{
                name += $(this).html()+",";
            }

        });
//        console.log("n:"+name+"l"+ $(p).siblings('li').length);
        $(p).remove();



//         sessionStorage.setItem('relatedAccessory',name);
        $("input:file").val(name);
//        console.log("fName："+fName);
//        if(fName == null){
//            sessionStorage.setItem('relatedAccessory',name);
//        }else{
//            sessionStorage.setItem('relatedAccessory',fName+','+name);
//        }
        var num = $("#result").children();
        if(num.length > 0){
            $("#hintImage").css('display','block');
        }else{
            $("#hintImage").css('display','none');
        }
    }

</script>

</body>
</html>